<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Bit flips with Enums/flags | Akshat Harit's blog</title>
<meta name=keywords content="computer science">
<meta name=description content="TLDR If you can avoid code where an if else flag variable differ by a single bit, do it.
Or at least make sure that your code is better at error handling. The following is a hypothetical situation that didn&rsquo;t happen anywhere and caused no live sites.
Details The code was similar to
if (str[0] == '0') do_part1(str[1:]) else if (str[0] == '1'): do_part2(str[1:]) else: do_error_handling() If you think &lsquo;0&rsquo; and &lsquo;1&rsquo; are icky, replace it with an enum flag.">
<meta name=author content="Akshat Harit">
<link rel=canonical href=https://akshat-harit.github.io/posts/no_zero_enum_flag/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<link rel=preload href=/apple-touch-icon.png as=image>
<link rel=icon href=https://akshat-harit.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://akshat-harit.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://akshat-harit.github.io/favicon-16x16.png>
<link rel=apple-touch-icon href=https://akshat-harit.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://akshat-harit.github.io/apple-touch-icon.png>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.92.1">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><meta property="og:title" content="Bit flips with Enums/flags">
<meta property="og:description" content="TLDR If you can avoid code where an if else flag variable differ by a single bit, do it.
Or at least make sure that your code is better at error handling. The following is a hypothetical situation that didn&rsquo;t happen anywhere and caused no live sites.
Details The code was similar to
if (str[0] == '0') do_part1(str[1:]) else if (str[0] == '1'): do_part2(str[1:]) else: do_error_handling() If you think &lsquo;0&rsquo; and &lsquo;1&rsquo; are icky, replace it with an enum flag.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://akshat-harit.github.io/posts/no_zero_enum_flag/">
<meta property="og:image" content="https://akshat-harit.github.io/%3Cimage%20path/url%3E"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-01-22T16:47:32-08:00">
<meta property="article:modified_time" content="2022-01-22T16:47:32-08:00"><meta property="og:site_name" content="Akshat Harit's blog">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://akshat-harit.github.io/%3Cimage%20path/url%3E">
<meta name=twitter:title content="Bit flips with Enums/flags">
<meta name=twitter:description content="TLDR If you can avoid code where an if else flag variable differ by a single bit, do it.
Or at least make sure that your code is better at error handling. The following is a hypothetical situation that didn&rsquo;t happen anywhere and caused no live sites.
Details The code was similar to
if (str[0] == '0') do_part1(str[1:]) else if (str[0] == '1'): do_part2(str[1:]) else: do_error_handling() If you think &lsquo;0&rsquo; and &lsquo;1&rsquo; are icky, replace it with an enum flag.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://akshat-harit.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Bit flips with Enums/flags","item":"https://akshat-harit.github.io/posts/no_zero_enum_flag/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Bit flips with Enums/flags","name":"Bit flips with Enums\/flags","description":"TLDR If you can avoid code where an if else flag variable differ by a single bit, do it.\nOr at least make sure that your code is better at error handling. The following is a hypothetical situation that didn\u0026rsquo;t happen anywhere and caused no live sites.\nDetails The code was similar to\nif (str[0] == \u0026#39;0\u0026#39;) do_part1(str[1:]) else if (str[0] == \u0026#39;1\u0026#39;): do_part2(str[1:]) else: do_error_handling() If you think \u0026lsquo;0\u0026rsquo; and \u0026lsquo;1\u0026rsquo; are icky, replace it with an enum flag.","keywords":["computer science"],"articleBody":"TLDR If you can avoid code where an if else flag variable differ by a single bit, do it.\nOr at least make sure that your code is better at error handling. The following is a hypothetical situation that didn’t happen anywhere and caused no live sites.\nDetails The code was similar to\nif (str[0] == '0') do_part1(str[1:]) else if (str[0] == '1'): do_part2(str[1:]) else: do_error_handling() If you think ‘0’ and ‘1’ are icky, replace it with an enum flag.\nWe were generating string x as either a base64 encoded representation of a structure or a json representation. Then sending it to a cache and retrieving it as needed.\nThe problem is that code under do_part1 and do_part2 is not doing any error handling. As it trusts the input based on the check above. And the only source of input is the same process.\nYou could argue that the function should have done better error checks, but at some level in the stack, you have to trust the input. Here string length would have helped, but it could well have been a memory address where we get expected length based on first byte. And this could easily trigger a crash due to access violation.\nIf instead we had if (str[0] == '0') do_part(str[1:]) else if (str[0] == '.'): do_part(str[1:]) else: do_error_handling() We probably would have gone into the error handling code, since it is much harder to bit flip from ‘0’ i.e. 0b110001 to ‘.’ i.e. 0b101110.\nI think general guidance would be to add 3 to get guaranteed two bit difference. I originally had above code comparing to ‘A’ but realized that A’s binary representation 0b1000001 is actually also one bit flip away from ‘0’ 0b110001.\nOf course, ideal case would be to have better error handling, but I have to admit, that when I am writing code, I am not usually thinking of bit flips. Perhaps that’ll change after seeing this case in the service.\nWorrisome is that we frequently use enum to go into different branching paths. The enum values frequently differ by a single bit.\n","wordCount":"349","inLanguage":"en","image":"https://akshat-harit.github.io/%3Cimage%20path/url%3E","datePublished":"2022-01-22T16:47:32-08:00","dateModified":"2022-01-22T16:47:32-08:00","author":{"@type":"Person","name":"Akshat Harit"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://akshat-harit.github.io/posts/no_zero_enum_flag/"},"publisher":{"@type":"Organization","name":"Akshat Harit's blog","logo":{"@type":"ImageObject","url":"https://akshat-harit.github.io/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://akshat-harit.github.io/ accesskey=h title="Home (Alt + H)">
<img src=/apple-touch-icon.png alt=logo aria-label=logo height=35>Home</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://akshat-harit.github.io/categories/ title=categories>
<span>categories</span>
</a>
</li>
<li>
<a href=https://akshat-harit.github.io/tags/ title=tags>
<span>tags</span>
</a>
</li>
<li>
<a href=https://akshat-harit.github.io/about/ title="About Me">
<span>About Me</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://akshat-harit.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://akshat-harit.github.io/posts/>Posts</a></div>
<h1 class=post-title>
Bit flips with Enums/flags
</h1>
<div class=post-meta><span title="2022-01-22 16:47:32 -0800 -0800">January 22, 2022</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Akshat Harit&nbsp;|&nbsp;<a href=https://github.com/akshat-harit/akshat-harit.github.io/content/posts/no_zero_enum_flag.md rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div>
</header>
<div class=post-content><h2 id=tldr>TLDR<a hidden class=anchor aria-hidden=true href=#tldr>#</a></h2>
<p>If you can avoid code where an if else flag variable differ by a single bit, <strong>do it</strong>.</p>
<p>Or at least make sure that your code is better at error handling. The following is a hypothetical situation that didn&rsquo;t happen anywhere and caused no live sites.</p>
<h2 id=details>Details<a hidden class=anchor aria-hidden=true href=#details>#</a></h2>
<p>The code was similar to</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>if</span> (str[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;0&#39;</span>)
    do_part1(str[<span style=color:#ae81ff>1</span>:])
<span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (str[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;1&#39;</span>):
    do_part2(str[<span style=color:#ae81ff>1</span>:])
<span style=color:#66d9ef>else</span>:
    do_error_handling()</code></pre></div>
<p>If you think &lsquo;0&rsquo; and &lsquo;1&rsquo; are icky, replace it with an enum flag.</p>
<p>We were generating string x as either a base64 encoded representation of a structure or a json representation. Then sending it to a cache and retrieving it as needed.</p>
<p>The problem is that code under do_part1 and do_part2 is not doing any error handling. As it trusts the input based on the check above. And the only source of input is the same process.</p>
<p>You could argue that the function should have done better error checks, but at some level in the stack, you have to trust the input. Here string length would have helped, but it could well have been a memory address where we get expected length based on first byte. And this could easily trigger a crash due to access violation.</p>
<p>If instead we had
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>if</span> (str[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;0&#39;</span>)
    do_part(str[<span style=color:#ae81ff>1</span>:])
<span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (str[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;.&#39;</span>):
    do_part(str[<span style=color:#ae81ff>1</span>:])
<span style=color:#66d9ef>else</span>:
    do_error_handling()</code></pre></div>
We probably would have gone into the error handling code, since it is much harder to bit flip from &lsquo;0&rsquo; i.e. 0b110001 to &lsquo;.&rsquo; i.e. 0b101110.</p>
<p>I think general guidance would be to add 3 to get guaranteed two bit difference. I originally had above code comparing to &lsquo;A&rsquo; but realized that A&rsquo;s binary representation 0b1000001 is actually also one bit flip away from &lsquo;0&rsquo; 0b110001.</p>
<p>Of course, ideal case would be to have better error handling, but I have to admit, that when I am writing code, I am not usually thinking of bit flips. Perhaps that&rsquo;ll change after seeing this case in the service.</p>
<p>Worrisome is that we frequently use enum to go into different branching paths. The enum values frequently differ by a single bit.</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://akshat-harit.github.io/tags/computer-science/>computer science</a></li>
</ul>
<nav class=paginav>
<a class=next href=https://akshat-harit.github.io/posts/soylent_banana_bread/>
<span class=title>Next Page »</span>
<br>
<span>Meal replacement banana bread</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Bit flips with Enums/flags on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fakshat-harit.github.io%2fposts%2fno_zero_enum_flag%2f&title=Bit%20flips%20with%20Enums%2fflags"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Bit flips with Enums/flags on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fakshat-harit.github.io%2fposts%2fno_zero_enum_flag%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Bit flips with Enums/flags on hackernews" href="https://news.ycombinator.com/submitlink?t=Bit%20flips%20with%20Enums%2fflags&u=https%3a%2f%2fakshat-harit.github.io%2fposts%2fno_zero_enum_flag%2f"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentcolor" stroke="none" stroke-width="1"><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://akshat-harit.github.io/>Akshat Harit's blog</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>