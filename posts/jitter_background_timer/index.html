<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Jitter Background Timer | Akshat Harit's blog</title><meta name=keywords content="computer science"><meta name=description content="Adding jitter to background threads"><meta name=author content="Akshat Harit"><link rel=canonical href=https://akshat-harit.github.io/posts/jitter_background_timer/><meta name=google-site-verification content="erTAE5oaXRQcZWwjRqOxvq1qoL29FZK5XMxkK8aJc1Q"><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><link rel=preload href=/apple-touch-icon.png as=image><link rel=icon href=https://akshat-harit.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://akshat-harit.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://akshat-harit.github.io/favicon-16x16.png><link rel=apple-touch-icon href=https://akshat-harit.github.io/apple-touch-icon.png><link rel=mask-icon href=https://akshat-harit.github.io/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.94.2"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Jitter Background Timer"><meta property="og:description" content="Adding jitter to background threads"><meta property="og:type" content="article"><meta property="og:url" content="https://akshat-harit.github.io/posts/jitter_background_timer/"><meta property="og:image" content="https://akshat-harit.github.io/%3Cimage%20path/url%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-19T15:47:20-07:00"><meta property="article:modified_time" content="2022-03-19T15:47:20-07:00"><meta property="og:site_name" content="Akshat Harit's blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://akshat-harit.github.io/%3Cimage%20path/url%3E"><meta name=twitter:title content="Jitter Background Timer"><meta name=twitter:description content="Adding jitter to background threads"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://akshat-harit.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Jitter Background Timer","item":"https://akshat-harit.github.io/posts/jitter_background_timer/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Jitter Background Timer","name":"Jitter Background Timer","description":"Adding jitter to background threads","keywords":["computer science"],"articleBody":"I am usually good about adding jitter on retry timers. I think this is necessary so we don’t run into a situation where if server fails due to concurrent clients at one time, we don’t coordinate retries at the same time to exacerbate the problem.\nBut hadn’t thought about it from the context of background threads and process startups. I have usually seen backgrounds threads doing everything from contacting the server to populate some cache, refresh some system token before expiry, cleaning up some cache etc. Usually these are on a fixed timer, like update the background cache every five minutes.\nThis is usually fine. If you have thousands of machines, the likelihood of them starting at same time is low as deployment has to be staggered after a certain scale. We practice safe deployment! And there is a natural jitter inherent to the service if you are getting response from a server. However, we had to do a massive service restart recently and seeing graph like this was uncomfortable. Simulated with 2000 machines, time period of thread being 300 seconds. Ever adding one second of jitter reduces peak by half. 10 seconds results in peak reduced by 119. Problem is that that if you add this at process start, you are intentionally slowing down startup. Doesn’t matter much if process starts once and then is running for months, but you’ll have to think about your use case.\nI don’t think you have to worry about this for 99% of the cases. For the .9 % of cases use your standard libraries random number generator and think about adding some random jitter whenever you start a background thread. For the .1%, even this will not help and probably introduces some other bug that I can’t think about right now.\nRough Python code to generate the graphs is here\nimport numpy as np from matplotlib import pyplot as plt from numpy.polynomial.polynomial import polyfit import seaborn as sns minutes = 60 jitter = 0 period = 300 machine_count = 2000 simulation_time = minutes*60 count = (simulation_time//period)+20 class Time_counter:  def __init__(self, start=0, period=period, jitter=jitter, count=count):  self.firing_time = np.zeros(count)  if jitter != 0:  r = np.random.randint(low=(-1*jitter), high=jitter, size=count)  else:  r = np.zeros(count)  for i, jitter in enumerate(r):  self.firing_time[i] = self.firing_time[i-1]+jitter+period   def get_firing_time(self):  return self.firing_time #https://stackoverflow.com/questions/19068862/how-to-overplot-a-line-on-a-scatter-plot-in-python/19069001#19069001 def jitter_and_plot(jitter=jitter):  x = np.arange(0,simulation_time)  y = np.zeros(simulation_time)  for i in range(machine_count):  m = Time_counter(jitter=jitter)  for i in m.get_firing_time():  i = int(i)  if i  len(y):  y[i] +=1  max_machine_count = int(max(y))  y[ y==0 ] = np.nan  plt.rcParams[\"figure.figsize\"] = (20,10)  plt.title(\"Jitter=\"+str(jitter)+ \" Period=\" + str(period)+ \" Max machines at one second=\"+str(max_machine_count))  plt.xlabel(\"Seconds\")  plt.ylabel(\"Machines\")  plt.scatter(x,y)  plt.show() ","wordCount":"435","inLanguage":"en","image":"https://akshat-harit.github.io/%3Cimage%20path/url%3E","datePublished":"2022-03-19T15:47:20-07:00","dateModified":"2022-03-19T15:47:20-07:00","author":{"@type":"Person","name":"Akshat Harit"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://akshat-harit.github.io/posts/jitter_background_timer/"},"publisher":{"@type":"Organization","name":"Akshat Harit's blog","logo":{"@type":"ImageObject","url":"https://akshat-harit.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://akshat-harit.github.io/ accesskey=h title="Home (Alt + H)"><img src=/apple-touch-icon.png alt=logo aria-label=logo height=35>Home</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://akshat-harit.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://akshat-harit.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://akshat-harit.github.io/about/ title="About Me"><span>About Me</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://akshat-harit.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://akshat-harit.github.io/posts/>Posts</a></div><h1 class=post-title>Jitter Background Timer</h1><div class=post-description>Adding jitter to background threads</div><div class=post-meta><span title="2022-03-19 15:47:20 -0700 -0700">March 19, 2022</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Akshat Harit&nbsp;|&nbsp;<a href=https://github.com/akshat-harit/akshat-harit.github.io/content/posts/jitter_background_timer.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>I am usually good about adding jitter on retry timers. I think this is necessary so we don&rsquo;t run into a situation where if server fails due to concurrent clients at one time, we don&rsquo;t coordinate retries at the same time to exacerbate the problem.</p><p>But hadn&rsquo;t thought about it from the context of background threads and process startups.
I have usually seen backgrounds threads doing everything from contacting the server to populate some cache, refresh some system token before expiry, cleaning up some cache etc. Usually these are on a fixed timer, like update the background cache every five minutes.</p><p>This is usually fine. If you have thousands of machines, the likelihood of them starting at same time is low as deployment has to be staggered after a certain scale. We practice safe deployment!
And there is a natural jitter inherent to the service if you are getting response from a server. However, we had to do a massive service restart recently and seeing graph like this was uncomfortable.
Simulated with 2000 machines, time period of thread being 300 seconds.
<img loading=lazy src=../../images/jitter0.png alt="Image showing peak of 2000 machines with 0 jitter"></p><p>Ever adding one second of jitter reduces peak by half.
<img loading=lazy src=../../images/jitter1.png alt="Image showing peak of 2000 machines with 0 jitter"></p><p>10 seconds results in peak reduced by 119.
<img loading=lazy src=../../images/jitter10.png alt="Image showing peak of 2000 machines with 0 jitter"></p><p>Problem is that that if you add this at process start, you are intentionally slowing down startup. Doesn&rsquo;t matter much if process starts once and then is running for months, but you&rsquo;ll have to think about your use case.</p><p>I don&rsquo;t think you have to worry about this for 99% of the cases. For the .9 % of cases use your standard libraries random number generator and think about adding some random jitter whenever you start a background thread. For the .1%, even this will not help and probably introduces some other bug that I can&rsquo;t think about right now.</p><p>Rough Python code to generate the graphs is here</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> matplotlib <span style=color:#f92672>import</span> pyplot <span style=color:#66d9ef>as</span> plt
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> numpy.polynomial.polynomial <span style=color:#f92672>import</span> polyfit
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> seaborn <span style=color:#66d9ef>as</span> sns
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>minutes <span style=color:#f92672>=</span> <span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span>jitter <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>period <span style=color:#f92672>=</span> <span style=color:#ae81ff>300</span>
</span></span><span style=display:flex><span>machine_count <span style=color:#f92672>=</span> <span style=color:#ae81ff>2000</span>
</span></span><span style=display:flex><span>simulation_time <span style=color:#f92672>=</span> minutes<span style=color:#f92672>*</span><span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span>count <span style=color:#f92672>=</span> (simulation_time<span style=color:#f92672>//</span>period)<span style=color:#f92672>+</span><span style=color:#ae81ff>20</span> 
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Time_counter</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, start<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, period<span style=color:#f92672>=</span>period, jitter<span style=color:#f92672>=</span>jitter, count<span style=color:#f92672>=</span>count):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>firing_time <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>zeros(count)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> jitter <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            r <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>random<span style=color:#f92672>.</span>randint(low<span style=color:#f92672>=</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>*</span>jitter), high<span style=color:#f92672>=</span>jitter, size<span style=color:#f92672>=</span>count)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            r <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>zeros(count)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i, jitter <span style=color:#f92672>in</span> enumerate(r):
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>firing_time[i] <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>firing_time[i<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]<span style=color:#f92672>+</span>jitter<span style=color:#f92672>+</span>period
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_firing_time</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>firing_time
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#https://stackoverflow.com/questions/19068862/how-to-overplot-a-line-on-a-scatter-plot-in-python/19069001#19069001</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>jitter_and_plot</span>(jitter<span style=color:#f92672>=</span>jitter):
</span></span><span style=display:flex><span>    x <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>arange(<span style=color:#ae81ff>0</span>,simulation_time)
</span></span><span style=display:flex><span>    y <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>zeros(simulation_time)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(machine_count):
</span></span><span style=display:flex><span>        m <span style=color:#f92672>=</span> Time_counter(jitter<span style=color:#f92672>=</span>jitter)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> m<span style=color:#f92672>.</span>get_firing_time():
</span></span><span style=display:flex><span>            i <span style=color:#f92672>=</span> int(i)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> i <span style=color:#f92672>&lt;</span> len(y):
</span></span><span style=display:flex><span>                y[i] <span style=color:#f92672>+=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    max_machine_count <span style=color:#f92672>=</span> int(max(y))
</span></span><span style=display:flex><span>    y[ y<span style=color:#f92672>==</span><span style=color:#ae81ff>0</span> ] <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>nan
</span></span><span style=display:flex><span>    plt<span style=color:#f92672>.</span>rcParams[<span style=color:#e6db74>&#34;figure.figsize&#34;</span>] <span style=color:#f92672>=</span> (<span style=color:#ae81ff>20</span>,<span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>    plt<span style=color:#f92672>.</span>title(<span style=color:#e6db74>&#34;Jitter=&#34;</span><span style=color:#f92672>+</span>str(jitter)<span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; Period=&#34;</span> <span style=color:#f92672>+</span> str(period)<span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; Max machines at one second=&#34;</span><span style=color:#f92672>+</span>str(max_machine_count)) 
</span></span><span style=display:flex><span>    plt<span style=color:#f92672>.</span>xlabel(<span style=color:#e6db74>&#34;Seconds&#34;</span>) 
</span></span><span style=display:flex><span>    plt<span style=color:#f92672>.</span>ylabel(<span style=color:#e6db74>&#34;Machines&#34;</span>) 
</span></span><span style=display:flex><span>    plt<span style=color:#f92672>.</span>scatter(x,y) 
</span></span><span style=display:flex><span>    plt<span style=color:#f92672>.</span>show()
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://akshat-harit.github.io/tags/computer-science/>computer science</a></li></ul><nav class=paginav><a class=prev href=https://akshat-harit.github.io/posts/keywest_mango_ginger_lime_cake/><span class=title>« Prev Page</span><br><span>Keywest Mango Ginger Lime Cake</span></a>
<a class=next href=https://akshat-harit.github.io/posts/who_asks_the_questions/><span class=title>Next Page »</span><br><span>Better interviewer?</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Jitter Background Timer on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fakshat-harit.github.io%2fposts%2fjitter_background_timer%2f&title=Jitter%20Background%20Timer"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Jitter Background Timer on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fakshat-harit.github.io%2fposts%2fjitter_background_timer%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Jitter Background Timer on hackernews" href="https://news.ycombinator.com/submitlink?t=Jitter%20Background%20Timer&u=https%3a%2f%2fakshat-harit.github.io%2fposts%2fjitter_background_timer%2f"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentcolor" stroke="none" stroke-width="1"><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://akshat-harit.github.io/>Akshat Harit's blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>